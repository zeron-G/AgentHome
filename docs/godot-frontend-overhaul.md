# AgentHome â€” Godot å‰ç«¯å…¨é¢é‡æ„é¡¹ç›®æ–‡æ¡£

> **ç›®æ ‡**: å°†å½“å‰çº¯æ–‡å­—UIçš„Godotå‰ç«¯å‡çº§ä¸ºäº§å“çº§2Dæ¸¸æˆï¼ŒåŒ…å«TileMapåœ°å›¾ã€è§’è‰²ç²¾çµåŠ¨ç”»ã€æš—é»‘å¡”ç½—å™äº‹ä¸»é¢˜UIã€å®Œæ•´è®¾ç½®ç³»ç»Ÿã€AIç”Ÿæˆç¾æœ¯èµ„äº§ã€‚
>
> **ç¼–å†™æ—¥æœŸ**: 2026-02-27
>
> **çŠ¶æ€**: è®¡åˆ’å·²ç¡®è®¤ï¼Œå°šæœªå¼€å§‹å®æ–½

---

## ç›®å½•

1. [å½“å‰é¡¹ç›®çŠ¶æ€](#1-å½“å‰é¡¹ç›®çŠ¶æ€)
2. [ç¾æœ¯æ–¹å‘ä¸é£æ ¼å®šä¹‰](#2-ç¾æœ¯æ–¹å‘ä¸é£æ ¼å®šä¹‰)
3. [èµ„äº§éœ€æ±‚æ¸…å•](#3-èµ„äº§éœ€æ±‚æ¸…å•)
4. [æŠ€æœ¯æ¶æ„é‡æ„](#4-æŠ€æœ¯æ¶æ„é‡æ„)
5. [å®æ–½é˜¶æ®µä¸ä»»åŠ¡åˆ†è§£](#5-å®æ–½é˜¶æ®µä¸ä»»åŠ¡åˆ†è§£)
6. [åç«¯æ•°æ®æ¥å£](#6-åç«¯æ•°æ®æ¥å£)
7. [è§’è‰²ä¸å™äº‹ç³»ç»Ÿå‚è€ƒ](#7-è§’è‰²ä¸å™äº‹ç³»ç»Ÿå‚è€ƒ)

---

## 1. å½“å‰é¡¹ç›®çŠ¶æ€

### 1.1 æŠ€æœ¯æ ˆ

| å±‚ | æŠ€æœ¯ | è¯´æ˜ |
|---|---|---|
| åç«¯ | Python FastAPI + WebSocket | `main.py` å…¥å£ï¼Œ`ws/` WebSocketå±‚ |
| LLMå¼•æ“ | Claude / Gemini / æœ¬åœ°LLM | å¤šæä¾›å•†æ”¯æŒï¼Œç»“æ„åŒ–è¾“å‡º |
| Agentç³»ç»Ÿ | ä¸‰å±‚åˆ†çº§å†³ç­– | ç­–ç•¥å±‚(LLM) â†’ æˆ˜æœ¯å±‚(è§„åˆ™) â†’ æ‰§è¡Œå±‚(LLM) |
| ä¸–ç•Œå¼•æ“ | `engine/world.py` | 20Ã—20ç½‘æ ¼ï¼Œ5ç§åœ°å½¢ï¼Œ5ç§èµ„æº |
| å‰ç«¯ | Godot 4.6 (GDScript) | **å½“å‰ä¸ºçº¯ç¨‹åºåŒ–æ–‡å­—UI** |

### 1.2 Godotå‰ç«¯ç°çŠ¶

**å¼•æ“**: Godot 4.6, Forward Plusæ¸²æŸ“å™¨, 1280Ã—800è§†å£

**é¡¹ç›®é…ç½® (`project.godot`)**:
- ä¸»åœºæ™¯: `res://scenes/main_menu.tscn`
- Autoload: `GameState` â†’ `res://scripts/autoload/game_state.gd`
- å­—ä½“: `NotoSansSC-VF.ttf` (ä¸­æ–‡æ”¯æŒ)
- Jolt Physics (æœªä½¿ç”¨)

**å½“å‰æ–‡ä»¶æ¸…å• (15ä¸ªGDScript, 2323è¡Œ)**:

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|---|---|---|
| `scripts/game_manager.gd` | 265 | ä¸­å¤®ç¼–æ’å™¨ï¼šæ„å»ºæ‰€æœ‰UIã€å¤„ç†è¾“å…¥ã€è½¬å‘WebSocketæ¶ˆæ¯ |
| `scripts/main_menu.gd` | 112 | ä¸»èœå•åœºæ™¯ |
| `scripts/ws_client.gd` | 78 | WebSocketå®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨é‡è¿+æŒ‡æ•°é€€é¿ï¼‰ |
| `scripts/zone_map.gd` | 95 | åæ ‡â†’ä¸­æ–‡åœ°åæ˜ å°„ |
| `scripts/autoload/game_state.gd` | 162 | å…¨å±€çŠ¶æ€å•ä¾‹ï¼Œç¼“å­˜åç«¯æ•°æ® |
| `scripts/ui/header_bar.gd` | 120 | é¡¶éƒ¨çŠ¶æ€æ ï¼ˆæ—¶é—´/å¤©æ°”/tokenï¼‰ |
| `scripts/ui/narrative_panel.gd` | 49 | BBCodeæ»šåŠ¨äº‹ä»¶æ—¥å¿— |
| `scripts/ui/dialogue_panel.gd` | 111 | NPCå¯¹è¯+é€‰é¡¹ |
| `scripts/ui/status_panel.gd` | 268 | ç©å®¶è§’è‰²é¢æ¿ |
| `scripts/ui/npc_list_panel.gd` | 287 | NPCåˆ—è¡¨ï¼ˆæŒ‰è·ç¦»æ’åºï¼‰ |
| `scripts/ui/market_panel.gd` | 208 | å¸‚åœºä»·æ ¼è¡¨+ä¹°å– |
| `scripts/ui/mini_map.gd` | 83 | **æ–‡å­—ç¬¦å·å°åœ°å›¾**ï¼ˆ11Ã—11 gridï¼Œç”¨å­—ç¬¦ç»˜åˆ¶ï¼‰ |
| `scripts/ui/settings_panel.gd` | 426 | è®¾ç½®é¢æ¿ |
| `scripts/ui/action_bar.gd` | 38 | åŠ¨ä½œæŒ‰é’®æ¡ |
| `scripts/ui/god_panel.gd` | 21 | æ—ç™½é¢æ¿ |

**åœºæ™¯æ–‡ä»¶**:
- `scenes/main_menu.tscn` â€” ä¸»èœå•
- `scenes/game.tscn` â€” æ¸¸æˆåœºæ™¯ï¼ˆControlæ ¹èŠ‚ç‚¹ + WSClientå­èŠ‚ç‚¹ï¼Œå…¶ä½™å…¨éƒ¨ç¨‹åºåŒ–ç”Ÿæˆï¼‰
- `node.tscn` â€” ç©ºèŠ‚ç‚¹

**ç¾æœ¯èµ„äº§**: **é›¶**ï¼ˆä»…æœ‰ icon.svg å’Œå­—ä½“æ–‡ä»¶ï¼‰

**æ ¸å¿ƒé—®é¢˜**:
1. æ‰€æœ‰UIå‡ç”±GDScriptç¨‹åºåŒ–æ„å»ºï¼Œæ— åœºæ™¯å¤ç”¨
2. å°åœ°å›¾æ˜¯æ–‡å­—ç¬¦å·ï¼ˆ`.` `~` `^` `T` `E`ï¼‰ï¼Œä¸æ˜¯çœŸæ­£çš„2Dåœ°å›¾
3. è§’è‰²ä»…ä»¥é¢œè‰²æ–¹å—åœ¨æ–‡å­—åœ°å›¾ä¸Šè¡¨ç¤º
4. æ— ä»»ä½•å›¾ç‰‡/ç²¾çµ/åŠ¨ç”»èµ„äº§
5. æ— è§†è§‰ä¸»é¢˜ï¼ˆä½¿ç”¨Godoté»˜è®¤ä¸»é¢˜ï¼‰
6. é”®ç›˜è¾“å…¥ç¡¬ç¼–ç ï¼ˆWASDã€Gã€Eã€Rã€Zã€Spaceç­‰ï¼‰

### 1.3 åç«¯æ¶æ„å…³é”®ä¿¡æ¯

**WebSocketé€šä¿¡**: å®¢æˆ·ç«¯è¿æ¥ `ws://localhost:8000/ws`ï¼Œæ¥æ”¶JSONä¸–ç•Œå¿«ç…§

**ä¸–ç•Œæ•°æ®æ¨¡å‹** (`engine/world.py`):

```
World 20Ã—20
â”œâ”€â”€ Tile[20][20]
â”‚   â”œâ”€â”€ tile_type: TileType (grass|water|rock|forest|town)
â”‚   â”œâ”€â”€ resource: Resource? (wood|stone|ore|food|herb, quantity/max_quantity)
â”‚   â”œâ”€â”€ is_exchange: bool
â”‚   â”œâ”€â”€ furniture: str? ("bed"|"table"|"chair")
â”‚   â”œâ”€â”€ npc_ids: list[str]
â”‚   â””â”€â”€ player_here: bool
â”œâ”€â”€ NPC[9]
â”‚   â”œâ”€â”€ npc_id, name, x, y, color, energy, personality
â”‚   â”œâ”€â”€ inventory: Inventory (wood/stone/ore/food/herb/rope/potion/tool/bread/gold)
â”‚   â”œâ”€â”€ profile: NPCProfile (title/backstory/personality/goals/speech_style/relationships)
â”‚   â”œâ”€â”€ goal: str, plan: list[str]  â† ç­–ç•¥å±‚è¾“å‡º
â”‚   â”œâ”€â”€ mood: str  â† æƒ…ç»ªçŠ¶æ€
â”‚   â”œâ”€â”€ last_action, last_message, last_thought
â”‚   â”œâ”€â”€ last_action_result: str  â† ReActè§‚æµ‹åé¦ˆ
â”‚   â””â”€â”€ equipped: str? ("tool"|"rope")
â”œâ”€â”€ Player
â”‚   â”œâ”€â”€ player_id, name, x, y, energy
â”‚   â”œâ”€â”€ inventory, equipped, last_action, last_message
â”‚   â”œâ”€â”€ last_action_result: str
â”‚   â”œâ”€â”€ inbox: list[msg]
â”‚   â””â”€â”€ dialogue_queue: list[dialogue]
â”œâ”€â”€ Market
â”‚   â”œâ”€â”€ prices: {item: {base, current, min, max, trend, change_pct}}
â”‚   â””â”€â”€ history: {item: list[float]}
â”œâ”€â”€ Time
â”‚   â”œâ”€â”€ tick, hour, day, phase (dawn|day|dusk|night)
â”‚   â””â”€â”€ time_str
â”œâ”€â”€ Weather: sunny|rainy|storm
â””â”€â”€ God
    â”œâ”€â”€ last_commentary: str
    â””â”€â”€ narrative_state (current_season, secret_stage)
```

**WebSocket JSONå¿«ç…§æ ¼å¼** (`ws/serializer.py`):

```json
{
  "type": "world_state",
  "tick": 42,
  "simulation_running": true,
  "time": {"hour": 14.5, "day": 3, "phase": "day", "time_str": "14:30"},
  "weather": "sunny",
  "tiles": [
    {"x": 0, "y": 0, "t": "g", "r": "w", "q": 5, "mq": 10, "n": ["npc_he"], "e": 0, "p": 0, "f": null}
  ],
  "npcs": [
    {
      "id": "npc_he", "name": "ç¦¾", "x": 5, "y": 3, "color": "#4CAF50",
      "energy": 85, "inventory": {"wood": 3, "food": 2, "gold": 10},
      "last_action": "gather", "last_message": "ä»Šå¹´çš„æ”¶æˆä¸é”™",
      "last_message_tick": 40, "is_processing": false,
      "equipped": null, "inv_count": 5, "inv_max": 20,
      "pending_proposals": 0,
      "goal": "é‡‡é›†é£Ÿç‰©å‡†å¤‡æ™šé¤", "plan": ["å»æ£®æ—é‡‡é›†é£Ÿç‰©", "å›å®¶åšé¥­"],
      "thought": "ç©—è¯¥é¥¿äº†å§",
      "profile": {
        "title": "III çš‡å", "backstory": "...", "personality": "æ¸©æš–åŒ…å®¹...",
        "goals": ["ç…§é¡¾ç©—", "..."], "speech_style": "...",
        "relationships": {"npc_sui": "æ¯å¥³Â·è¿‡åº¦ä¿æŠ¤..."}
      }
    }
  ],
  "player": {
    "id": "player", "name": "ç©å®¶", "x": 12, "y": 12,
    "energy": 90, "is_god_mode": false,
    "inventory": {...}, "equipped": null,
    "last_action": "move", "last_message": "",
    "inbox": [...], "dialogue": null
  },
  "god": {"commentary": "åˆåçš„é˜³å…‰æ´’åœ¨ç”°é‡ä¸Š..."},
  "events": [
    {"type": "npc_spoke", "tick": 41, "npc_id": "npc_he", "message": "ä»Šå¹´çš„æ”¶æˆä¸é”™", "x": 5, "y": 3}
  ],
  "market": {
    "prices": {"wood": {"base": 1.5, "current": 1.65, "min": 0.45, "max": 4.5, "trend": "up", "change_pct": 3.2}},
    "history": {"wood": [1.5, 1.55, 1.6, 1.65]},
    "last_update_tick": 40
  },
  "token_usage": {...},
  "settings": {
    "show_npc_thoughts": true, "npc_vision_radius": 2,
    "world_tick_seconds": 3.0, "npc_min_think": 5.0, "npc_max_think": 10.0,
    "god_min_think": 20.0, "god_max_think": 40.0,
    "npc_hearing_radius": 5, "food_energy_restore": 30, "sleep_energy_restore": 50,
    "exchange_rate_wood": 1, "exchange_rate_stone": 2, "exchange_rate_ore": 5, "food_cost_gold": 3
  }
}
```

**Tileç±»å‹ç¼–ç **: `"g"`=è‰åœ°, `"f"`=æ£®æ—, `"r"`=å²©çŸ³, `"w"`=æ°´åŸŸ, `"o"`=åŸé•‡
**èµ„æºç±»å‹ç¼–ç **: `"w"`=æœ¨å¤´, `"s"`=çŸ³å¤´, `"o"`=çŸ¿çŸ³, `"f"`=é£Ÿç‰©, `"h"`=è‰è¯

**å®¢æˆ·ç«¯â†’æœåŠ¡ç«¯åŠ¨ä½œ**ï¼ˆé€šè¿‡WebSocketå‘é€ï¼‰:
```json
{"action": "move", "dx": 1, "dy": 0}
{"action": "gather"}
{"action": "eat"}
{"action": "rest"}
{"action": "sleep"}
{"action": "craft", "item": "rope"}
{"action": "build", "item": "bed"}
{"action": "sell", "item": "wood", "quantity": 3}
{"action": "buy", "item": "food", "quantity": 1}
{"action": "equip", "item": "tool"}
{"action": "talk_to", "target": "npc_he"}
{"action": "say", "message": "ä½ å¥½"}
{"action": "toggle_simulation"}
{"action": "dialogue_reply", "reply_index": 0}
{"action": "update_settings", "key": "world_tick_seconds", "value": 5.0}
```

### 1.4 åç«¯å¾…æ‰©å±•å­—æ®µ

ä»¥ä¸‹å­—æ®µå·²åœ¨åç«¯æ•°æ®æ¨¡å‹ä¸­å­˜åœ¨ï¼Œä½†**å°šæœªé€šè¿‡åºåˆ—åŒ–å™¨å‘é€ç»™å‰ç«¯**ï¼š

| å­—æ®µ | æ¥æº | è¯´æ˜ | éœ€æ·»åŠ ä½ç½® |
|---|---|---|---|
| `npc.mood` | NPCç­–ç•¥å±‚è¾“å‡º | NPCå½“å‰æƒ…ç»ªï¼ˆå¦‚"ç„¦è™‘"ã€"å¼€å¿ƒ"ï¼‰ | `_serialize_npc()` |
| `npc.last_action_result` | ä¸–ç•Œå¼•æ“åé¦ˆ | ä¸Šæ¬¡è¡ŒåŠ¨ç»“æœï¼ˆå¦‚"é‡‡é›†äº†3ä¸ªæœ¨å¤´"ï¼‰ | `_serialize_npc()` |
| `player.last_action_result` | ä¸–ç•Œå¼•æ“åé¦ˆ | ç©å®¶è¡ŒåŠ¨ç»“æœ | `_serialize_player()` |
| `season` | `config_narrative.SEASON_CONFIG` | å½“å‰å­£èŠ‚é”®åï¼ˆspring/summer/autumn/winterï¼‰ | `time` å¯¹è±¡ |
| `season_name` | `config_narrative.SEASON_CONFIG` | å­£èŠ‚æ˜¾ç¤ºåï¼ˆå¦‚"æ˜¥Â·æ’­ç§"ï¼‰ | `time` å¯¹è±¡ |
| `god.season` | `NarrativeState` | å½“å‰å™äº‹å­£èŠ‚ | `god` å¯¹è±¡ |
| `god.narrative_stage` | `NarrativeState` | å½“å‰å™äº‹é˜¶æ®µ(0-3) | `god` å¯¹è±¡ |

---

## 2. ç¾æœ¯æ–¹å‘ä¸é£æ ¼å®šä¹‰

### 2.1 æ€»ä½“é£æ ¼

**æ ¸å¿ƒå‚è€ƒ**:
- **å…«æ–¹æ—…äºº (Octopath Traveler)** â€” HD-2Dç¾å­¦ï¼šåƒç´ äººç‰© + é«˜å“è´¨èƒŒæ™¯/CGï¼Œå±‚æ¬¡æ„Ÿä¸°å¯Œ
- **é¥¥è’ (Don't Starve)** â€” è¯¡å¼‚æ„Ÿï¼šæš—è‰²è°ƒã€ä¸å¯¹ç§°è®¾è®¡ã€ç•¥å¸¦ä¸å®‰çš„æ°›å›´

**é£æ ¼å…³é”®è¯**: æš—é»‘ç«¥è¯ã€å¡”ç½—ç¥ç§˜ã€HD-2Dã€åƒç´ +æ‰‹ç»˜æ··åˆã€è¯¡å¼‚æ¸©é¦¨

### 2.2 åŒå±‚ç¾æœ¯ä½“ç³»

æœ¬é¡¹ç›®é‡‡ç”¨**åƒç´ å±‚ + HDå±‚**åˆ†ç¦»çš„ç¾æœ¯ä½“ç³»ï¼Œå¯¹åº”ä¸åŒåœºæ™¯ä½¿ç”¨ï¼š

| å±‚ | é€‚ç”¨åœºæ™¯ | é£æ ¼ | å°ºå¯¸ | ç”Ÿæˆæ–¹å¼ |
|---|---|---|---|---|
| **åƒç´ å±‚** | æ¸¸æˆåœ°å›¾ã€è§’è‰²è¡Œèµ°ã€ç‰©å“å›¾æ ‡ | ç²¾è‡´åƒç´ ç¾æœ¯ | 32Ã—32 / 16Ã—16 | Pillowç¨‹åºåŒ– + AIåå¤„ç† |
| **HDå±‚** | è§’è‰²ç«‹ç»˜ã€å¯¹è¯å¤´åƒã€CGæ’ç”»ã€UIè£…é¥°ã€å¡”ç½—ç‰Œé¢ | HDæ‰‹ç»˜/åŠå†™å® | 256Ã—256~1024Ã—1024 | Nano Banana Pro AIç”Ÿæˆ |

### 2.3 è‰²å½©è§„èŒƒ

**UIåŸºç¡€è‰²æ¿**ï¼ˆæš—é»‘å¡”ç½—ä¸»é¢˜ï¼‰:

```
bg_dark       = #0a0a14    // æœ€æ·±èƒŒæ™¯
bg_panel      = #14141eea  // é¢æ¿èƒŒæ™¯ï¼ˆå«é€æ˜åº¦ï¼‰
bg_lighter    = #1a1a2e    // æ¬¡çº§é¢æ¿
text_primary  = #e0e0e8    // ä¸»æ–‡å­—
text_secondary= #8888a0    // è¾…åŠ©æ–‡å­—
accent_gold   = #c8a832    // é‡‘è‰²å¼ºè°ƒï¼ˆå¡”ç½—å…ƒç´ ï¼‰
accent_green  = #4ecca3    // ç»¿è‰²ï¼ˆå¯¹è¯/ç§¯æï¼‰
accent_red    = #e94560    // çº¢è‰²ï¼ˆè­¦å‘Š/ç©å®¶ï¼‰
accent_purple = #9c27b0    // ç´«è‰²ï¼ˆGodæ—ç™½/ç¥ç§˜ï¼‰
accent_blue   = #2196f3    // è“è‰²ï¼ˆä¿¡æ¯ï¼‰
accent_orange = #f5a623    // æ©™è‰²ï¼ˆäº¤æ˜“/ç»æµï¼‰
border_dark   = #2a2a3e    // è¾¹æ¡†
```

**è§’è‰²ä»£è¡¨è‰²**:

| è§’è‰² | é¢œè‰² | hex | è¯´æ˜ |
|---|---|---|---|
| ç¦¾ (çš‡å) | ç»¿è‰² | #4CAF50 | æ¸©æš–ç”Ÿå‘½åŠ› |
| ç©— (å¤ªé˜³) | ç²‰è‰² | #E91E63 | å¤©çœŸæ´»æ³¼ |
| å±± (éšè€…) | çº¢æ£• | #F44336 | æ²‰ç¨³åšé‡ |
| æ£  (å€’åŠäºº) | æ©™è‰² | #FF5722 | çƒ­æƒ…ä½†çŸ›ç›¾ |
| æ—· (åŠ›é‡) | è“è‰² | #2196F3 | å¤©çœŸæ— ç• |
| æœ¨ (æ•™çš‡) | æ£•è‰² | #795548 | æœ´å®ä¼ ç»Ÿ |
| å²šå©† (å¥³ç¥­å¸) | ç´«è‰² | #9C27B0 | ç¥ç§˜é€šçµ |
| çŸ³ (æ‹äºº) | ç°è“ | #607D8B | æ²‰é»˜åšå®š |
| å•†äºº (æ¶é­”) | é‡‘è‰² | #FFC107 | å…‰é²œè¯±æƒ‘ |
| ç©å®¶ (æ„šè€…) | æ·±çº¢ | #e94560 | å†’é™©æœªçŸ¥ |

**æ˜¼å¤œè‰²è°ƒ**:

| æ—¶æ®µ | phaseå€¼ | è‰²è°ƒ(CanvasModulate) | æ°›å›´ |
|---|---|---|---|
| æ™¨ | dawn | Color(1.0, 0.9, 0.8) | æš–æ©™ï¼Œæ–°çš„å¼€å§‹ |
| æ—¥ | day | Color(1.0, 1.0, 1.0) | ä¸­æ€§è‡ªç„¶å…‰ |
| æ˜ | dusk | Color(0.9, 0.7, 0.6) | æš–çº¢æ©™ï¼Œç•¥æ˜¾ä¸å®‰ |
| å¤œ | night | Color(0.4, 0.4, 0.7) | æ·±è“ï¼Œç¥ç§˜å‹è¿« |

**å­£èŠ‚è‰²è°ƒå åŠ **:

| å­£èŠ‚ | è‰²æ¸©åç§» | æ°›å›´ |
|---|---|---|
| æ˜¥Â·æ’­ç§ | åæš–ç»¿ | å¸Œæœ›ã€æ–°ç”Ÿ |
| å¤Â·å¼‚å˜ | åæš—çƒ­ | é—·é›·ã€ä¸å®‰ |
| ç§‹Â·ç¢è£‚ | åå†·æ©™ | è½å¶ã€ç¢è£‚ |
| å†¬Â·æŠ‰æ‹© | åå†·ç™½ | å¯’å†·ã€æ²‰é‡ |

---

## 3. èµ„äº§éœ€æ±‚æ¸…å•

### 3.1 åƒç´ èµ„äº§ï¼ˆPillowç¨‹åºåŒ–ç”Ÿæˆ + AIåå¤„ç†ï¼‰

#### 3.1.1 åœ°å½¢ç“¦ç‰‡ (32Ã—32 px)

| ID | åç§° | å˜ä½“æ•° | è§†è§‰æè¿° |
|---|---|---|---|
| `grass_0~3` | è‰åœ° | 4 | æ·±ç»¿åº•(#2a4a2a)ï¼Œéšæœºè‰ä¸›ç‚¹ç¼€ï¼Œæ¯ä¸ªå˜ä½“ä¸åŒæ‚è‰åˆ†å¸ƒ |
| `forest_0~2` | æ£®æ— | 3 | æ›´æ·±ç»¿(#1a3a1a)ï¼Œä¸‰è§’æ ‘å½±è½®å»“+æš—ç»¿æ ‘å†  |
| `rock_0~1` | å²©çŸ³ | 2 | ç°è‰²(#5a5a5a)ï¼Œæ£±è§’å½¢çŠ¶+è£‚çº¹çº¿ |
| `water_0` | æ°´åŸŸ | 1 | æ·±è“(#1a3a5a)ï¼Œæ³¢æµªçº¿çº¹ç† |
| `town_0~1` | åŸé•‡ | 2 | æš–æ£•(#5a4a3a)ï¼Œæ–¹å½¢æˆ¿å±‹è½®å»“+çª—æˆ·é»„å…‰ |
| `exchange` | äº¤æ˜“æ‰€ | 1 | æ£•åº•+é‡‘è‰²(#c8a832)è¾¹æ¡†+å¸‚åœºç¬¦å·ï¼ˆå¤©å¹³æˆ–é‡‘å¸ï¼‰ |

**åˆè®¡**: 13å¼ ç“¦ç‰‡PNG

**TileMapæ˜ å°„è§„åˆ™**:
- `"g"` â†’ `grass_N` (N = hash(x,y) % 4)
- `"f"` â†’ `forest_N` (N = hash(x,y) % 3)
- `"r"` â†’ `rock_N` (N = hash(x,y) % 2)
- `"w"` â†’ `water_0`
- `"o"` â†’ `town_N` (N = hash(x,y) % 2)
- `is_exchange=true` â†’ `exchange`

#### 3.1.2 è§’è‰²ç²¾çµè¡¨ (æ¯å¸§32Ã—32, ç²¾çµè¡¨ 128Ã—96)

æ¯ä¸ªè§’è‰²ä¸€å¼ ç²¾çµè¡¨ï¼Œ4åˆ—Ã—3è¡Œ = 12å¸§ï¼š

```
æ’åˆ—ï¼š
  åˆ—: ä¸‹(0) | å·¦(1) | å³(2) | ä¸Š(3)
  è¡Œ: idle(0) | walk_a(1) | walk_b(2)
```

| è§’è‰² | æ–‡ä»¶å | ä½“è‰² | å¤–è§‚ç‰¹å¾ | ä½“å‹ |
|---|---|---|---|---|
| ç¦¾ | `npc_he.png` | #4CAF50 | å›´è£™+å‘é«» | æˆäººå¥³æ€§ |
| ç©— | `npc_sui.png` | #E91E63 | çŸ®å°+åŒé©¬å°¾ | å„¿ç«¥ |
| å±± | `npc_shan.png` | #F44336 | ä½å»+æ‹æ–è½®å»“ | æˆäººé«˜ |
| æ£  | `npc_tang.png` | #FF5722 | å›´å·¾ | æˆäººç”·æ€§ |
| æ—· | `npc_kuang.png` | #2196F3 | çŸ®å°+ä¹±å‘ | å„¿ç«¥ |
| æœ¨ | `npc_mu.png` | #795548 | å·¥å…·è…°å¸¦ | æˆäººç”·æ€§ |
| å²šå©† | `npc_lan.png` | #9C27B0 | æŠ«è‚©+ä½å» | æˆäººå¥³æ€§ |
| çŸ³ | `npc_shi.png` | #607D8B | èƒŒä¸Šå¼“è½®å»“ | æˆäººç”·æ€§ |
| å•†äºº | `npc_shangren.png` | #FFC107 | å¸½å­+èƒŒåŒ… | æˆäººç”·æ€§ |
| ç©å®¶ | `player.png` | #e94560 | æŠ«é£ | æˆäºº |

**åˆè®¡**: 10å¼ ç²¾çµè¡¨PNG

#### 3.1.3 ç‰©å“å›¾æ ‡ (16Ã—16 px)

| æ–‡ä»¶å | ç‰©å“ | è§†è§‰æè¿° |
|---|---|---|
| `wood.png` | æœ¨å¤´ | æ£•è‰²åœ†æœ¨æ®µ |
| `stone.png` | çŸ³å¤´ | ç°è‰²ä¸è§„åˆ™çŸ³å— |
| `ore.png` | çŸ¿çŸ³ | æ·±ç°+è“è‰²ç»“æ™¶ |
| `food.png` | é£Ÿç‰© | ç»¿è‰²éº¦ç©—/è°·ç‰© |
| `herb.png` | è‰è¯ | ç»¿è‰²è‰å¶+çº¢è‰²æµ†æœ |
| `rope.png` | ç»³å­ | æ£•é»„è‰²ç»³åœˆ |
| `potion.png` | è¯æ°´ | ç´«è‰²/è“è‰²è¯ç“¶ |
| `tool.png` | å·¥å…· | é”¤å­/æ‰³æ‰‹ |
| `bread.png` | é¢åŒ… | é‡‘æ£•è‰²é¢åŒ… |
| `gold.png` | é‡‘å¸ | é‡‘è‰²åœ†å¸ |

**åˆè®¡**: 10å¼ å›¾æ ‡PNG

#### 3.1.4 å®¶å…·å›¾æ ‡ (32Ã—32 px)

| æ–‡ä»¶å | å®¶å…· | è§†è§‰æè¿° |
|---|---|---|
| `bed.png` | åºŠ | æœ¨è´¨åºŠ+è¢«è¤¥ |
| `table.png` | æ¡Œå­ | æœ¨è´¨æ–¹æ¡Œ |
| `chair.png` | æ¤…å­ | æœ¨è´¨æ¤…å­ |

**åˆè®¡**: 3å¼ å®¶å…·PNG

#### 3.1.5 èµ„æºè¦†ç›–ç²¾çµ (32Ã—32 px)

æ”¾åœ¨æœ‰èµ„æºçš„åœ°æ ¼ä¸Šæ–¹çš„åŠé€æ˜ç²¾çµï¼š

| æ–‡ä»¶å | è¯´æ˜ |
|---|---|
| `res_wood.png` | æ ‘æ¡©/åŸæœ¨å †ï¼ˆæ£®æ—é‡‡é›†ç‚¹ï¼‰ |
| `res_stone.png` | çŸ³å † |
| `res_ore.png` | çŸ¿è„‰ |
| `res_food.png` | æœå®/å†œä½œç‰© |
| `res_herb.png` | è‰ä¸›+èŠ± |

**åˆè®¡**: 5å¼ èµ„æºè¦†ç›–PNG

#### 3.1.6 ç²’å­çº¹ç†

| æ–‡ä»¶å | å°ºå¯¸ | è¯´æ˜ |
|---|---|---|
| `rain_drop.png` | 2Ã—8 | ç™½/è“è‰²é›¨æ»´ |
| `snow_flake.png` | 4Ã—4 | ç™½è‰²é›ªèŠ± |
| `storm_bolt.png` | 8Ã—16 | é»„è‰²é—ªç”µï¼ˆé—ªçƒç”¨ï¼‰ |

**åˆè®¡**: 3å¼ ç²’å­PNG

#### 3.1.7 æƒ…ç»ªå›¾æ ‡ (16Ã—16 px)

| æ–‡ä»¶å | æƒ…ç»ª | è§†è§‰ |
|---|---|---|
| `mood_happy.png` | å¼€å¿ƒ | ç»¿è‰²ç¬‘è„¸ |
| `mood_neutral.png` | å¹³é™ | é»„è‰²å¹³è„¸ |
| `mood_sad.png` | æ‚²ä¼¤ | è“è‰²å“­è„¸ |
| `mood_anxious.png` | ç„¦è™‘ | æ©™è‰²æ³¢æµªè„¸ |
| `mood_angry.png` | æ„¤æ€’ | çº¢è‰²æ€’è„¸ |

**åˆè®¡**: 5å¼ æƒ…ç»ªPNG

### 3.2 HDç¾æœ¯èµ„äº§ï¼ˆNano Banana Pro AIç”Ÿæˆï¼‰

> **é£æ ¼ç»Ÿä¸€è¦æ±‚**: æ‰€æœ‰HDèµ„äº§å¿…é¡»ä¿æŒä¸€è‡´çš„å…«æ–¹æ—…äººé£æ ¼ + é¥¥è’è¯¡å¼‚æ„Ÿã€‚
> å»ºè®®ä½¿ç”¨ç»Ÿä¸€çš„promptå‰ç¼€/é£æ ¼ç§å­ç¡®ä¿ä¸€è‡´æ€§ã€‚

#### 3.2.1 è§’è‰²ç«‹ç»˜ / å¯¹è¯å¤´åƒ

æ¯ä¸ªè§’è‰²éœ€è¦ï¼š
- **åŠèº«ç«‹ç»˜** (256Ã—384 æˆ–ç±»ä¼¼ç«–ç‰ˆ): ç”¨äºè§’è‰²è¯¦æƒ…å¼¹çª—
- **å¯¹è¯å¤´åƒ** (128Ã—128): ç”¨äºå¯¹è¯é¢æ¿ï¼Œæ˜¾ç¤ºåœ¨NPCåå­—æ—è¾¹

| è§’è‰² | promptå…³é”®ç‰¹å¾ | æƒ…ç»ªå˜ä½“ |
|---|---|---|
| ç¦¾ (III çš‡å) | æˆç†Ÿå¥³æ€§ï¼Œå›´è£™ï¼Œå‘é«»ï¼Œæ¸©æš–çœ¼ç¥ï¼Œæ‰‹ä¸Šæœ‰æ³¥åœŸ | å¾®ç¬‘(é»˜è®¤), æ‹…å¿§, ä¸¥è‚ƒ |
| ç©— (XIX å¤ªé˜³) | å°å¥³å­©(~8å²)ï¼ŒåŒé©¬å°¾ï¼Œå¤§çœ¼ç›ï¼Œæ´»æ³¼å¤©çœŸï¼Œæ‰‹é‡Œå¸¸æ‹¿ç”»ç¬” | å¥½å¥‡(é»˜è®¤), å®³æ€•, å¼€å¿ƒ |
| å±± (IX éšè€…) | è€è€…ï¼Œä½å»ï¼Œæ‹æ–ï¼Œæ·±é‚ƒçœ¼ç¥ï¼Œé•¿ç™½èƒ¡é¡» | æ²‰æ€(é»˜è®¤), æ‚²ä¼¤, æ„å‘³æ·±é•¿çš„ç¬‘ |
| æ£  (XII å€’åŠäºº) | é’å¹´ç”·æ€§ï¼Œå›´å·¾ï¼Œçƒ­æƒ…ä½†ç„¦èºï¼Œçœ¼ä¸‹é’é»‘ | ç¬‘(é»˜è®¤), ç—›è‹¦, è¿·èŒ« |
| æ—· (VIII åŠ›é‡) | å°ç”·å­©(~6å²)ï¼Œä¹±å‘ï¼Œç²¾åŠ›å……æ²›ï¼Œèº«ä¸Šæœ‰æ³¥ | å…´å¥‹(é»˜è®¤), ç–‘æƒ‘, ç¬‘ |
| æœ¨ (V æ•™çš‡) | ä¸­å¹´ç”·æ€§ï¼Œç²—æ‰‹ï¼Œå·¥å…·è…°å¸¦ï¼Œæœ´å®è„¸åº | ä¸“æ³¨(é»˜è®¤), å›°æƒ‘, å¾®ç¬‘ |
| å²šå©† (II å¥³ç¥­å¸) | è€å¦‡äººï¼ŒæŠ«è‚©ï¼ŒåŠé®é¢ï¼Œç¥ç§˜å¾®ç¬‘ | ç¥ç§˜(é»˜è®¤), ææƒ§, é€šçµ |
| çŸ³ (VI æ‹äºº) | å¹´è½»ç”·æ€§ï¼Œå¼“èƒŒä¸Šï¼Œæ²‰é»˜å¯¡è¨€ï¼Œå·çœ‹æŸå¤„ | å†·é™(é»˜è®¤), å¿ƒåŠ¨, è­¦è§‰ |
| å•†äºº (XV æ¶é­”) | å¤–è¡¨å’Œå–„çš„ä¸­å¹´å•†äººï¼Œç¬‘å®¹è¿‡äºå®Œç¾ï¼Œå¸½å­é®é˜´å½± | å¾®ç¬‘(é»˜è®¤), çœŸé¢ç›®(æš—å½±), äº¤æ˜“ |
| ç©å®¶ (0 æ„šè€…) | å¹´è½»äººï¼ŒæŠ«é£ï¼Œå¥½å¥‡çœ¼ç¥ï¼Œåˆšå›åˆ°æ‘å­ | ä¸­æ€§(é»˜è®¤) |

**å»ºè®®prompté£æ ¼å‰ç¼€ç¤ºä¾‹**:
```
HD-2D style illustration, dark fairy tale aesthetic, semi-realistic with hand-drawn texture,
muted earthy tones with subtle unease, reminiscent of Octopath Traveler meets Don't Starve,
vignette lighting, slightly asymmetric features, [character specific description]
```

**åˆè®¡**: 10è§’è‰² Ã— (1ç«‹ç»˜ + 1~3å¤´åƒ) = ~30å¼ HD PNG

#### 3.2.2 å¡”ç½—ç‰Œé¢

æ¯å¼ å¤§é˜¿å°”å¡çº³å¯¹åº”ä¸€ä¸ªè§’è‰²/äº‹ä»¶ï¼Œç”¨äºè§’è‰²è¯¦æƒ…å¼¹çª—å’Œçº¿ç´¢æ”¶é›†UIï¼š

| ç‰Œå· | åç§° | å¯¹åº”è§’è‰² | è§†è§‰ä¸»é¢˜ |
|---|---|---|---|
| 0 | æ„šè€… | ç©å®¶ | æ‚¬å´–è¾¹çš„æ—…äººï¼Œç™½è‰²å¤ªé˜³èŠ± |
| II | å¥³ç¥­å¸ | å²šå©† | å¸·å¹•ä¸¤ä¾§ï¼Œä¸€åªçœ¼çœ‹çœŸå® |
| III | çš‡å | ç¦¾ | ä¸°æ”¶ç”°é‡ä¸­çš„æ¯äº²ï¼Œéº¦ç©—çš‡å†  |
| IV | çš‡å¸ | çˆ·çˆ·/God | çŸ³åº§ä¸Šçš„å®ˆæŠ¤è€…ï¼Œç»“ç•Œå…‰ç¯ |
| V | æ•™çš‡ | æœ¨ | å·¥åŠä¸­çš„ä¼ æ‰¿è€…ï¼Œæ‰‹æŒæ—§ç¬¦æ–‡ |
| VI | æ‹äºº | çŸ³ | æ£®æ—ä¸­çš„å®ˆæœ›è€…ï¼Œå¼“ä¸æœˆå…‰ |
| VIII | åŠ›é‡ | æ—· | å°ç”·å­©éª‘åœ¨å¤§é‡å…½ä¸Šï¼Œæ¯«ä¸å®³æ€• |
| IX | éšè€… | å±± | å±±é¡¶æç¯çš„è€äººï¼Œçœ‹åˆ°ä¸€åˆ‡ |
| XII | å€’åŠäºº | æ£  | å€’æ‚¬äºä¸–ç•Œæ ‘ä¸Šï¼Œè§†è§’åè½¬ |
| XV | æ¶é­” | å•†äºº | å¤©å¹³ä¸é”é“¾ï¼Œè¯±äººçš„å…‰ |
| XIX | å¤ªé˜³ | ç©— | ç«¥çœŸä¹‹å…‰ç©¿é€é»‘æš— |
| X | å‘½è¿ä¹‹è½® | å±±çš„é“å…· | è½¬åŠ¨çš„è½®ç›˜ï¼Œæ—¶é—´å¾ªç¯ |
| XXI | ä¸–ç•Œ | çœŸç»“å±€ | æ‰“ç ´æ‰€æœ‰å¢™å£ï¼Œè‡ªç”± |

**æ¯å¼ ç‰Œé¢å°ºå¯¸**: 200Ã—320 æˆ– 256Ã—400 (æ¥è¿‘æ ‡å‡†å¡”ç½—ç‰Œæ¯”ä¾‹ 2:3.3)

**åˆè®¡**: 13~22å¼ å¡”ç½—ç‰ŒPNGï¼ˆå¯å…ˆåš13å¼ æ ¸å¿ƒçš„ï¼Œå…¶ä½™åç»­è¡¥å……ï¼‰

#### 3.2.3 CG/å…³é”®åœºæ™¯æ’ç”»

ç”¨äºé‡è¦å™äº‹èŠ‚ç‚¹ï¼ˆGodæ—ç™½ç‰¹æ®Šäº‹ä»¶ã€å­£èŠ‚è½¬æ¢ã€ç»“å±€ç­‰ï¼‰çš„å…¨å±/åŠå±æ’ç”»ï¼š

| åœºæ™¯ID | æè¿° | è§¦å‘æ—¶æœº | å°ºå¯¸ |
|---|---|---|---|
| `cg_village_dawn` | æ‘å­æ—¥å‡ºå…¨æ™¯â€”â€”ç”°é‡ã€å°æˆ¿å­ã€è¿œå±± | æ¸¸æˆå¼€åœº/æ¯æ—¥æ™¨ | 1280Ã—800 |
| `cg_spring` | æ˜¥æ—¥æ’­ç§â€”â€”ç»¿è‰²ç”°é‡ï¼Œç¦¾åœ¨åŠ³ä½œ | æ˜¥å­£å¼€å§‹ | 640Ã—400 |
| `cg_summer_omen` | å¤æ—¥å¼‚å˜â€”â€”çº¢è‰²é»„æ˜ï¼Œè¿œå¤„é—ªç”µ | å¤å­£äº‹ä»¶ | 640Ã—400 |
| `cg_autumn_fall` | ç§‹æ—¥ç¢è£‚â€”â€”è½å¶ä¸­æµ®ç°ç¬¦æ–‡ | ç§‹å­£äº‹ä»¶ | 640Ã—400 |
| `cg_winter_choice` | å†¬æ—¥æŠ‰æ‹©â€”â€”é›ªä¸­çš„æ‘å­ï¼Œçº¢é›ªé™ä¸´ | å†¬å­£äº‹ä»¶ | 640Ã—400 |
| `cg_barrier` | ç»“ç•Œâ€”â€”æ‘å­è¢«å…‰å¢™åŒ…å›´çš„å…¨æ™¯ | çº¿ç´¢æ­ç¤º | 640Ã—400 |
| `cg_merchant_night` | å•†äººæ·±å¤œâ€”â€”ä»ªå¼åœ°ç‚¹çš„å¹½æš—èº«å½± | å•†äººäº‹ä»¶ | 640Ã—400 |
| `cg_ending_X` | å„ç»“å±€CG (6+1) | ç»“å±€è§¦å‘ | 1280Ã—800 |

**åˆè®¡**: ~15å¼ CG/åœºæ™¯PNGï¼ˆä¼˜å…ˆçº§è¾ƒä½ï¼Œå¯è¿­ä»£æ·»åŠ ï¼‰

#### 3.2.4 UIè£…é¥°èµ„äº§

| èµ„äº§ | å°ºå¯¸ | è¯´æ˜ |
|---|---|---|
| `panel_bg.png` | ä¹å®«æ ¼ 64Ã—64 | æš—è‰²é¢æ¿èƒŒæ™¯ï¼Œå¡”ç½—èŠ±çº¹è¾¹æ¡† |
| `button_normal.png` | ä¹å®«æ ¼ 32Ã—32 | æŒ‰é’®å¸¸æ€ |
| `button_hover.png` | ä¹å®«æ ¼ 32Ã—32 | æŒ‰é’®æ‚¬åœ |
| `button_pressed.png` | ä¹å®«æ ¼ 32Ã—32 | æŒ‰é’®æŒ‰ä¸‹ |
| `tarot_frame.png` | ä¹å®«æ ¼ 64Ã—80 | å¡”ç½—ç‰Œå±•ç¤ºæ¡† |
| `season_spring.png` | 32Ã—32 | æ˜¥å­£å¾½ç« ï¼ˆå«©èŠ½ï¼‰ |
| `season_summer.png` | 32Ã—32 | å¤å­£å¾½ç« ï¼ˆå¤ªé˜³+ä¹Œäº‘ï¼‰ |
| `season_autumn.png` | 32Ã—32 | ç§‹å­£å¾½ç« ï¼ˆè½å¶ï¼‰ |
| `season_winter.png` | 32Ã—32 | å†¬å­£å¾½ç« ï¼ˆé›ªèŠ±ï¼‰ |
| `main_menu_bg.png` | 1280Ã—800 | ä¸»èœå•èƒŒæ™¯å›¾ |
| `loading_bg.png` | 1280Ã—800 | åŠ è½½ç”»é¢ |

**åˆè®¡**: ~11å¼ UIè£…é¥°PNG

### 3.3 è¾“å‡ºç›®å½•ç»“æ„

```
resources/art/
â”œâ”€â”€ tileset/          # åœ°å½¢ç“¦ç‰‡ (32Ã—32 px)
â”‚   â”œâ”€â”€ grass_0.png .. grass_3.png
â”‚   â”œâ”€â”€ forest_0.png .. forest_2.png
â”‚   â”œâ”€â”€ rock_0.png, rock_1.png
â”‚   â”œâ”€â”€ water_0.png
â”‚   â”œâ”€â”€ town_0.png, town_1.png
â”‚   â””â”€â”€ exchange.png
â”‚
â”œâ”€â”€ characters/       # è§’è‰²ç²¾çµè¡¨ (128Ã—96 px, 4åˆ—Ã—3è¡Œ)
â”‚   â”œâ”€â”€ player.png
â”‚   â”œâ”€â”€ npc_he.png .. npc_shangren.png
â”‚   â””â”€â”€ portraits/    # HDè§’è‰²ç«‹ç»˜+å¤´åƒ (AIç”Ÿæˆ)
â”‚       â”œâ”€â”€ he_portrait.png
â”‚       â”œâ”€â”€ he_avatar_default.png, he_avatar_worried.png, ...
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ icons/            # ç‰©å“å›¾æ ‡ (16Ã—16 px) + å®¶å…· (32Ã—32 px)
â”‚   â”œâ”€â”€ wood.png, stone.png, ore.png, food.png, herb.png
â”‚   â”œâ”€â”€ rope.png, potion.png, tool.png, bread.png, gold.png
â”‚   â”œâ”€â”€ bed.png, table.png, chair.png
â”‚   â””â”€â”€ res_wood.png, res_stone.png, ... (èµ„æºè¦†ç›– 32Ã—32)
â”‚
â”œâ”€â”€ ui/               # UIä¹å®«æ ¼ + è£…é¥°
â”‚   â”œâ”€â”€ panel_bg.png, button_*.png, tarot_frame.png
â”‚   â”œâ”€â”€ season_*.png, mood_*.png
â”‚   â”œâ”€â”€ main_menu_bg.png, loading_bg.png
â”‚   â””â”€â”€ tarot_cards/  # HDå¡”ç½—ç‰Œé¢ (AIç”Ÿæˆ)
â”‚       â”œâ”€â”€ tarot_00_fool.png
â”‚       â”œâ”€â”€ tarot_03_empress.png
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ cg/               # å…³é”®åœºæ™¯CG (AIç”Ÿæˆ)
â”‚   â”œâ”€â”€ cg_village_dawn.png
â”‚   â”œâ”€â”€ cg_spring.png .. cg_winter_choice.png
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ particles/        # ç²’å­çº¹ç†
    â”œâ”€â”€ rain_drop.png, snow_flake.png, storm_bolt.png
```

### 3.4 èµ„äº§æ€»é‡æ±‡æ€»

| ç±»åˆ« | æ•°é‡ | ç”Ÿæˆæ–¹å¼ | ä¼˜å…ˆçº§ |
|---|---|---|---|
| åœ°å½¢ç“¦ç‰‡ | 13 | Pillow + AIåå¤„ç† | P0 |
| è§’è‰²ç²¾çµè¡¨ | 10 | Pillow + AIåå¤„ç† | P0 |
| ç‰©å“å›¾æ ‡ | 10 | Pillow | P0 |
| å®¶å…·å›¾æ ‡ | 3 | Pillow | P1 |
| èµ„æºè¦†ç›– | 5 | Pillow | P1 |
| ç²’å­çº¹ç† | 3 | Pillow | P1 |
| æƒ…ç»ªå›¾æ ‡ | 5 | Pillow | P1 |
| UIè£…é¥° | 11 | Pillow + AI | P1 |
| HDè§’è‰²ç«‹ç»˜/å¤´åƒ | ~30 | Nano Banana Pro | P1 |
| å¡”ç½—ç‰Œé¢ | 13~22 | Nano Banana Pro | P2 |
| CGåœºæ™¯ | ~15 | Nano Banana Pro | P2 |
| **æ€»è®¡** | **~130** | | |

---

## 4. æŠ€æœ¯æ¶æ„é‡æ„

### 4.1 åœºæ™¯æ ‘é‡æ„

**å½“å‰**: Controlæ ¹èŠ‚ç‚¹ + WSClient â†’ å…¨éƒ¨ç¨‹åºåŒ–æ„å»º

**ç›®æ ‡**: Node2D + CanvasLayeræ··åˆæ¶æ„ï¼ˆå…¨å±åœ°å›¾ + åŠé€æ˜è¦†ç›–é¢æ¿ï¼‰

```
GameScene (Node2D) [game_manager.gd]
â”‚
â”œâ”€â”€ WSClient (Node) [ws_client.gd]
â”‚
â”œâ”€â”€ WorldLayer (Node2D) â†â”€â”€ æ¸¸æˆä¸–ç•Œï¼Œå—Camera2Då½±å“
â”‚   â”œâ”€â”€ TerrainMap (TileMapLayer) [tile_map_controller.gd]
â”‚   â”œâ”€â”€ ResourceOverlay (Node2D) [resource_overlay.gd]
â”‚   â”œâ”€â”€ FurnitureOverlay (Node2D) [furniture_overlay.gd]
â”‚   â”œâ”€â”€ Characters (Node2D) [character_manager.gd]
â”‚   â”‚   â”œâ”€â”€ CharacterNode (Node2D) [character_node.gd]  â† æ¯ä¸ªè§’è‰²ä¸€ä¸ª
â”‚   â”‚   â”‚   â”œâ”€â”€ Body (AnimatedSprite2D)
â”‚   â”‚   â”‚   â”œâ”€â”€ NameLabel (Label)
â”‚   â”‚   â”‚   â”œâ”€â”€ MoodIndicator (Sprite2D)
â”‚   â”‚   â”‚   â””â”€â”€ SelectionHighlight (Sprite2D)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ WeatherFX (GPUParticles2D) [weather_fx.gd]
â”‚   â””â”€â”€ DayNightOverlay (CanvasModulate) [day_night.gd]
â”‚
â”œâ”€â”€ Camera2D [game_camera.gd]
â”‚   â”œâ”€â”€ è·Ÿéšç©å®¶ (position_smoothing_enabled = true)
â”‚   â”œâ”€â”€ é¼ æ ‡æ»šè½®ç¼©æ”¾ (0.5x ~ 3.0x)
â”‚   â””â”€â”€ è¾¹ç•Œé™åˆ¶ (0 ~ 640px)
â”‚
â””â”€â”€ UILayer (CanvasLayer, layer=10) â†â”€â”€ UIå±‚ï¼Œä¸å—Cameraå½±å“
    â”œâ”€â”€ HUD (Control) â†â”€â”€ å¸¸é©»HUDå…ƒç´ 
    â”‚   â”œâ”€â”€ TopBar [header_bar.gd] â†â”€â”€ å…¨å®½40pxé¡¶éƒ¨æ 
    â”‚   â”œâ”€â”€ BottomBar [action_bar.gd] â†â”€â”€ å±…ä¸­åº•éƒ¨åŠ¨ä½œæ 
    â”‚   â”œâ”€â”€ GodPanel [god_panel.gd] â†â”€â”€ å±…ä¸­ä¸Šéƒ¨æ—ç™½è¦†ç›–
    â”‚   â”œâ”€â”€ MiniMap [mini_map.gd] â†â”€â”€ å³ä¸Šè§’160Ã—160
    â”‚   â””â”€â”€ NarrativePanel [narrative_panel.gd] â†â”€â”€ å·¦ä¾§å¯æŠ˜å 320px
    â”‚
    â”œâ”€â”€ Panels (Control) â†â”€â”€ å¯åˆ‡æ¢é¢æ¿
    â”‚   â”œâ”€â”€ SidePanel [side_panel.gd] â†â”€â”€ å³ä¾§300pxæ ‡ç­¾é¢æ¿
    â”‚   â”‚   â”œâ”€â”€ Tab: çŠ¶æ€ [status_panel.gd]
    â”‚   â”‚   â”œâ”€â”€ Tab: è§’è‰² [npc_list_panel.gd]
    â”‚   â”‚   â”œâ”€â”€ Tab: ç»æµ [market_panel.gd]
    â”‚   â”‚   â””â”€â”€ Tab: è®¾ç½® [settings_panel.gd]
    â”‚   â”œâ”€â”€ DialogueOverlay [dialogue_panel.gd] â†â”€â”€ å±…ä¸­åº•éƒ¨å¯¹è¯
    â”‚   â””â”€â”€ CharacterDetail [character_detail.gd] â†â”€â”€ å¼¹çª—ï¼šè§’è‰²è¯¦æƒ…
    â”‚
    â””â”€â”€ TalkBar (HBoxContainer) â†â”€â”€ åº•éƒ¨å¯¹è¯è¾“å…¥
```

### 4.2 æ–°å»ºæ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | é˜¶æ®µ | æè¿° | é¢„ä¼°è¡Œæ•° |
|---|---|---|---|
| `tools/generate_assets.py` | 1 | Pillowåƒç´ ç¾æœ¯ç”Ÿæˆå™¨ | ~800 |
| `tools/generate_hd_assets.py` | 1 | Nano Banana Pro HDèµ„äº§ç”Ÿæˆå™¨ | ~400 |
| `scripts/world/tile_map_controller.gd` | 1 | TileMapLayeræ§åˆ¶å™¨ | ~150 |
| `scripts/world/character_node.gd` | 2 | å•ä¸ªè§’è‰²èŠ‚ç‚¹ | ~200 |
| `scripts/world/character_manager.gd` | 2 | è§’è‰²ç®¡ç†å™¨ | ~150 |
| `scripts/world/game_camera.gd` | 2 | æ‘„åƒæœºæ§åˆ¶ | ~100 |
| `scripts/ui/ui_manager.gd` | 3 | UIé¢æ¿ç¼–æ’å™¨ | ~200 |
| `scripts/ui/side_panel.gd` | 3 | å³ä¾§æ ‡ç­¾é¢æ¿å®¹å™¨ | ~100 |
| `scripts/ui/character_detail.gd` | 3 | è§’è‰²è¯¦æƒ…å¼¹çª— | ~300 |
| `scripts/autoload/settings_manager.gd` | 3 | æœ¬åœ°è®¾ç½®æŒä¹…åŒ– | ~200 |
| `scripts/world/weather_fx.gd` | 4 | å¤©æ°”ç²’å­ç³»ç»Ÿ | ~100 |
| `scripts/world/day_night.gd` | 4 | æ˜¼å¤œå¾ªç¯ | ~80 |
| `scripts/world/resource_overlay.gd` | 4 | èµ„æºè¦†ç›–å±‚ | ~100 |
| `scripts/world/furniture_overlay.gd` | 4 | å®¶å…·è¦†ç›–å±‚ | ~80 |

**åˆè®¡**: ~2960è¡Œæ–°ä»£ç 

### 4.3 ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | é˜¶æ®µ | æ”¹åŠ¨æè¿° |
|---|---|---|
| `scenes/game.tscn` | 1 | ä»Controlæ”¹ä¸ºNode2Dæ ¹ + WorldLayer + UILayer |
| `scripts/game_manager.gd` | 1-4 | å¤§é‡é‡å†™ï¼šä»ç¨‹åºåŒ–UIæ„å»ºæ”¹ä¸ºç¼–æ’ä¸–ç•Œå±‚+UIå±‚ |
| `project.godot` | 1,3 | æ–°å¢autoload (SettingsManager)ï¼Œä¸»é¢˜é…ç½® |
| `ws/serializer.py` | 4 | æ–°å¢ mood/last_action_result/season å­—æ®µ |
| `scripts/autoload/game_state.gd` | 4 | æ–°å¢ season/mood å­—æ®µ + season_changedä¿¡å· |
| `scripts/ui/header_bar.gd` | 3 | é‡å†™ï¼šå­£èŠ‚å¾½ç«  + å¤©æ°”å›¾æ ‡ + è¿æ¥æŒ‡ç¤ºç¯ |
| `scripts/ui/narrative_panel.gd` | 3 | é‡å†™ï¼šå·¦ä¾§å¯æŠ˜å  + åˆ†ç±»ç€è‰² |
| `scripts/ui/dialogue_panel.gd` | 3 | é‡å†™ï¼šå±…ä¸­è¦†ç›– + NPCå¤´åƒ+é¢œè‰² + æ‰“å­—æœºæ•ˆæœ |
| `scripts/ui/status_panel.gd` | 3 | é‡å†™ï¼šç‰©å“å›¾æ ‡ + last_action_result |
| `scripts/ui/npc_list_panel.gd` | 3 | é‡å†™ï¼šç²¾çµé¢„è§ˆ + æƒ…ç»ªå›¾æ ‡ + ä¿¡ä»»æ¡ |
| `scripts/ui/market_panel.gd` | 3 | é‡å†™ï¼šä¸»é¢˜åŒ– + å›¾æ ‡ |
| `scripts/ui/mini_map.gd` | 3 | å®Œå…¨é‡å†™ï¼šæ–‡å­— â†’ å½©è‰²æ–¹å—+NPCç‚¹+è§†å£çŸ©å½¢ |
| `scripts/ui/settings_panel.gd` | 3 | é‡å†™ï¼šå®Œæ•´6èŠ‚è®¾ç½® |
| `scripts/ui/action_bar.gd` | 3 | é‡å†™ï¼šå›¾æ ‡æŒ‰é’® + ä¸Šä¸‹æ–‡æ•æ„Ÿ |

### 4.4 æ ¸å¿ƒGDScriptæ¨¡å—è¯¦ç»†è¯´æ˜

#### 4.4.1 TileMapæ§åˆ¶å™¨ (`tile_map_controller.gd`)

```gdscript
class_name TileMapController extends TileMapLayer

# èŒè´£:
# 1. _ready(): åŠ è½½ resources/art/tileset/ ä¸‹çš„çº¹ç†
# 2. ç¨‹åºåŒ–åˆ›å»º TileSetï¼ˆTileSetAtlasSource per çº¹ç†ï¼‰
# 3. update_from_world_data(tiles: Array): åç«¯tileæ•°ç»„ â†’ set_cell() è°ƒç”¨
# 4. ç“¦ç‰‡ç±»å‹æ˜ å°„: "g"â†’grass_N, "f"â†’forest_N, "r"â†’rock_N, "w"â†’water_0, "o"â†’town_N
# 5. å˜ä½“é€‰æ‹©: hash(x*31 + y*17) % variant_count

# å…¬å¼€æ–¹æ³•:
func update_from_world_data(tiles: Array) -> void
func get_world_position(grid_x: int, grid_y: int) -> Vector2  # ç½‘æ ¼åæ ‡ â†’ åƒç´ åæ ‡
func get_grid_position(world_pos: Vector2) -> Vector2i  # åƒç´ åæ ‡ â†’ ç½‘æ ¼åæ ‡
```

#### 4.4.2 è§’è‰²èŠ‚ç‚¹ (`character_node.gd`)

```gdscript
class_name CharacterNode extends Node2D

# å­èŠ‚ç‚¹:
# - Body (AnimatedSprite2D): ç²¾çµè¡¨åŠ¨ç”»
# - NameLabel (Label): è§’è‰²å(è§’è‰²é¢œè‰²)
# - MoodIndicator (Sprite2D): æƒ…ç»ªå›¾æ ‡ (16Ã—16)
# - SelectionHighlight (Sprite2D): é€‰ä¸­æ—¶å‘å…‰è¾¹æ¡†

# çŠ¶æ€:
var character_id: String
var grid_pos: Vector2i      # å½“å‰ç½‘æ ¼åæ ‡
var target_pos: Vector2     # ç›®æ ‡ä¸–ç•Œåæ ‡ï¼ˆç”¨äºå¹³æ»‘ç§»åŠ¨ï¼‰
var is_selected: bool = false

# åŠ¨ç”»ç»„:
# idle_down, idle_left, idle_right, idle_up
# walk_down, walk_left, walk_right, walk_up

# å…³é”®è¡Œä¸º:
# - _process(delta): ä½ç½® lerp åˆ° target_pos (speed * delta)
# - æ ¹æ®ç§»åŠ¨æ–¹å‘æ’­æ”¾walkåŠ¨ç”»ï¼Œåˆ°è¾¾åæ’­æ”¾idle
# - Z-index = y * 10ï¼ˆæ­£ç¡®é®æŒ¡ï¼‰
# - ç‚¹å‡» â†’ é€‰ä¸­é«˜äº®ï¼›åŒå‡» â†’ æ‰“å¼€è¯¦æƒ…

func update_from_data(data: Dictionary) -> void  # æ›´æ–°ä½ç½®/çŠ¶æ€
func set_mood(mood: String) -> void               # æ›´æ–°æƒ…ç»ªå›¾æ ‡
```

#### 4.4.3 è§’è‰²ç®¡ç†å™¨ (`character_manager.gd`)

```gdscript
class_name CharacterManager extends Node2D

# å­—å…¸ç®¡ç†: Dictionary[String, CharacterNode]
# - æ”¶åˆ°world_state â†’ å¯¹æ¯”ç°æœ‰è§’è‰² â†’ åˆ›å»º/æ›´æ–°/ç§»é™¤
# - PlayerèŠ‚ç‚¹ç‰¹æ®Šå¤„ç†ï¼ˆæ‘„åƒæœºè·Ÿéšç›®æ ‡ï¼‰

func update_characters(npcs: Array, player: Dictionary) -> void
func get_character(id: String) -> CharacterNode
func get_player_node() -> CharacterNode
```

#### 4.4.4 æ‘„åƒæœº (`game_camera.gd`)

```gdscript
class_name GameCamera extends Camera2D

# é…ç½®:
# - position_smoothing_enabled = true, position_smoothing_speed = 5.0
# - è·Ÿéšç©å®¶è§’è‰²èŠ‚ç‚¹
# - é¼ æ ‡æ»šè½®ç¼©æ”¾: 0.5x ~ 3.0x, æ­¥è¿›0.1, å¹³æ»‘æ’å€¼
# - è¾¹ç•Œé™åˆ¶: limit_left=0, limit_top=0, limit_right=640, limit_bottom=640
# - Homeé”®é‡æ–°å±…ä¸­

var follow_target: Node2D  # è®¾ä¸ºç©å®¶CharacterNode
var target_zoom: float = 1.0

func _input(event): # å¤„ç†æ»šè½®ç¼©æ”¾
func _process(delta): # å¹³æ»‘ç¼©æ”¾æ’å€¼
```

#### 4.4.5 è§’è‰²è¯¦æƒ…å¼¹çª— (`character_detail.gd`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å¡”ç½—ç‰Œé¢]  ç¦¾ - III çš‡å    [X] â”‚
â”‚  æ¯äº² | æƒ…ç»ª: ğŸ˜Š å¼€å¿ƒ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [HDç«‹ç»˜]  | æ€§æ ¼: æ¸©æš–åŒ…å®¹...      â”‚
â”‚            | ç›®æ ‡: é‡‡é›†é£Ÿç‰©...      â”‚
â”‚            | å½“å‰è®¡åˆ’:             â”‚
â”‚            |   âœ“ å»æ£®æ—            â”‚
â”‚            |   â†’ é‡‡é›†é£Ÿç‰©          â”‚
â”‚            |   â—‹ å›å®¶åšé¥­          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…³ç³»ç½‘:                          â”‚
â”‚  ç©—â†â†’æ¯å¥³Â·è¿‡åº¦ä¿æŠ¤                 â”‚
â”‚  å±±â†â†’å°Šæ•¬ | æ£ â†â†’å…³å¿ƒ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸–ç•Œè§‚: è¿™ç‰‡åœŸåœ°å…»è‚²äº†æˆ‘...        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åº“å­˜: ğŸªµÃ—3 ğŸÃ—2 ğŸ’°Ã—10            â”‚
â”‚  è£…å¤‡: æ—                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è¯´è¯] [äº¤æ˜“] [æŸ¥çœ‹æ›´å¤š]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.4.6 å®Œæ•´è®¾ç½®ç³»ç»Ÿ (`settings_panel.gd` + `settings_manager.gd`)

6ä¸ªè®¾ç½®åˆ†åŒºï¼š

**1. æ˜¾ç¤º**
- åˆ†è¾¨ç‡é€‰æ‹© (1280Ã—800, 1920Ã—1080, ...)
- çª—å£æ¨¡å¼ (çª—å£/å…¨å±/æ— è¾¹æ¡†)
- æ¸²æŸ“ç¼©æ”¾
- UIç¼©æ”¾
- VSyncå¼€å…³

**2. éŸ³é¢‘** (æ ‡æ³¨"å¼€å‘ä¸­")
- ä¸»éŸ³é‡æ»‘æ¡
- éŸ³ä¹éŸ³é‡
- éŸ³æ•ˆéŸ³é‡
- é™éŸ³æŒ‰é’®

**3. æ¸¸æˆ**
- ä¸–ç•Œåˆ»é€Ÿåº¦ (`world_tick_seconds`)
- NPCæ€è€ƒé€Ÿåº¦ (`npc_min_think`, `npc_max_think`)
- æ˜¾ç¤ºNPCæ€æƒ³ (`show_npc_thoughts`)
- NPCè§†é‡åŠå¾„ (`npc_vision_radius`)
- NPCå¬åŠ›åŠå¾„ (`npc_hearing_radius`)

**4. ç½‘ç»œ**
- æœåŠ¡å™¨URL (`ws://localhost:8000/ws`)
- è¿æ¥çŠ¶æ€æ˜¾ç¤º
- è‡ªåŠ¨é‡è¿å¼€å…³
- æ‰‹åŠ¨è¿æ¥/æ–­å¼€æŒ‰é’®

**5. LLM** (æ ‡æ³¨"é«˜çº§")
- LLMæä¾›å•†é€‰æ‹© (Claude/Gemini/æœ¬åœ°)
- APIå¯†é’¥è¾“å…¥ï¼ˆå¯†ç æ¨¡å¼ï¼‰
- æ¨¡å‹é€‰æ‹©
- æœ¬åœ°LLM URL

**6. ä¸–ç•Œæ§åˆ¶**
- å¤©æ°”åˆ‡æ¢
- èµ„æºåˆ·æ–°è®¾ç½®
- èƒ½é‡æ¢å¤è®¾ç½® (`food_energy_restore`, `sleep_energy_restore`)
- æ±‡ç‡è®¾ç½® (`exchange_rate_wood/stone/ore`, `food_cost_gold`)

**æŒä¹…åŒ–**: `ConfigFile` â†’ `user://settings.cfg`

### 4.5 å°åœ°å›¾ (`mini_map.gd`)

ä»æ–‡å­—ç¬¦å·å®Œå…¨é‡å†™ä¸ºè§†è§‰å°åœ°å›¾ï¼š

```gdscript
# 160Ã—160 åƒç´ ï¼Œå³ä¸Šè§’
# _draw() æ–¹æ³•ï¼š
# - éå†20Ã—20 tilesï¼Œæ¯æ ¼8Ã—8åƒç´ 
# - é¢œè‰²æ˜ å°„: grass=#2a4a2a, forest=#1a3a1a, rock=#5a5a5a, water=#1a3a5a, town=#5a4a3a
# - èµ„æºç‚¹: åŠé€æ˜ç‚¹
# - NPC: å„è‡ªé¢œè‰²çš„åœ†ç‚¹ (åŠå¾„2px)
# - ç©å®¶: çº¢è‰²åœ†ç‚¹ (åŠå¾„3px)
# - äº¤æ˜“æ‰€: é‡‘è‰²è¾¹æ¡†æ–¹å—
# - æ‘„åƒæœºè§†å£: ç™½è‰²åŠé€æ˜çŸ©å½¢æ¡†
# - ç‚¹å‡»å°åœ°å›¾ â†’ æ‘„åƒæœºè·³è½¬åˆ°å¯¹åº”ä¸–ç•Œåæ ‡
```

---

## 5. å®æ–½é˜¶æ®µä¸ä»»åŠ¡åˆ†è§£

### é˜¶æ®µ 1: èµ„äº§ç”Ÿæˆ + TileMapåŸºç¡€

**äº¤ä»˜ç‰©**: 20Ã—20å½©è‰²TileMapåœ°å›¾ + åŸºæœ¬UIæ¡†æ¶

| åºå· | ä»»åŠ¡ | è¯¦æƒ… | ä¾èµ– |
|---|---|---|---|
| 1.1 | åˆ›å»ºåƒç´ èµ„äº§ç”Ÿæˆå™¨ | `tools/generate_assets.py` (Python+Pillow)ï¼Œç”Ÿæˆæ‰€æœ‰åƒç´ çº§PNGåˆ° `resources/art/` | æ—  |
| 1.2 | åˆ›å»ºHDèµ„äº§ç”Ÿæˆå™¨ | `tools/generate_hd_assets.py` (Nano Banana Pro API)ï¼Œç”Ÿæˆç«‹ç»˜/å¤´åƒ/å¡”ç½—/CG | æ—  |
| 1.3 | è¿è¡Œç”Ÿæˆå™¨ | æ‰§è¡Œä¸¤ä¸ªç”Ÿæˆå™¨ï¼Œäº§å‡ºæ‰€æœ‰PNG | 1.1, 1.2 |
| 1.4 | AIåå¤„ç† | å¯¹Pillowç”Ÿæˆçš„åƒç´ èµ„äº§ç”¨Nano Banana Proè¿›è¡Œé£æ ¼ç»Ÿä¸€åŒ–åå¤„ç†ï¼ˆå¯é€‰ï¼‰ | 1.3 |
| 1.5 | åˆ›å»ºTileMapæ§åˆ¶å™¨ | `scripts/world/tile_map_controller.gd` | 1.3 |
| 1.6 | é‡æ„game.tscn | Node2Dæ ¹ + WorldLayer + UILayer æ¶æ„ | 1.5 |
| 1.7 | æ›´æ–°game_manager.gd | åˆå§‹åŒ–WorldLayer + åŸºæœ¬UIå®¹å™¨ | 1.6 |
| 1.8 | éªŒè¯ | å¯åŠ¨æ¸¸æˆâ†’çœ‹åˆ°20Ã—20å½©è‰²TileMap + åŸºæœ¬UI | 1.7 |

### é˜¶æ®µ 2: è§’è‰²ç³»ç»Ÿ + æ‘„åƒæœº

**äº¤ä»˜ç‰©**: è§’è‰²ç²¾çµå‡ºç°åœ¨åœ°å›¾ä¸Šï¼Œç§»åŠ¨å¹³æ»‘ï¼Œæ‘„åƒæœºè·Ÿéš

| åºå· | ä»»åŠ¡ | è¯¦æƒ… | ä¾èµ– |
|---|---|---|---|
| 2.1 | åˆ›å»ºè§’è‰²èŠ‚ç‚¹ | `character_node.gd`: AnimatedSprite2D + å¹³æ»‘ç§»åŠ¨ + åå­—æ ‡ç­¾ | é˜¶æ®µ1 |
| 2.2 | åˆ›å»ºè§’è‰²ç®¡ç†å™¨ | `character_manager.gd`: è§’è‰²æ± ç®¡ç† | 2.1 |
| 2.3 | åˆ›å»ºæ‘„åƒæœº | `game_camera.gd`: è·Ÿéš+ç¼©æ”¾+è¾¹ç•Œ | é˜¶æ®µ1 |
| 2.4 | é›†æˆåˆ°game_manager | ç»‘å®šworld_stateæ›´æ–° â†’ è§’è‰²ä½ç½®åŒæ­¥ | 2.2, 2.3 |
| 2.5 | è§’è‰²äº¤äº’ | ç‚¹å‡»é€‰ä¸­ + åŒå‡»æ‰“å¼€è¯¦æƒ… | 2.4 |
| 2.6 | éªŒè¯ | 10ä¸ªè§’è‰²åœ¨åœ°å›¾ä¸Šå¹³æ»‘ç§»åŠ¨ + æ‘„åƒæœºè·Ÿéš | 2.5 |

### é˜¶æ®µ 3: UIå…¨é¢é‡æ„

**äº¤ä»˜ç‰©**: æš—é»‘å¡”ç½—ä¸»é¢˜UI + æ‰€æœ‰é¢æ¿åŠŸèƒ½ + è§’è‰²è¯¦æƒ…å¼¹çª—

| åºå· | ä»»åŠ¡ | è¯¦æƒ… | ä¾èµ– |
|---|---|---|---|
| 3.1 | åˆ›å»ºæš—é»‘ä¸»é¢˜ | ç¨‹åºåŒ–åˆ›å»ºGodot Themeï¼Œå…¨å±€åº”ç”¨ | æ—  |
| 3.2 | åˆ›å»ºUIç®¡ç†å™¨ | `ui_manager.gd`: é¢æ¿æ˜¾ç¤º/éšè—ç¼–æ’ | 3.1 |
| 3.3 | åˆ›å»ºä¾§é¢æ¿å®¹å™¨ | `side_panel.gd`: å³ä¾§300pxæ ‡ç­¾é¢æ¿ | 3.2 |
| 3.4 | é‡å†™header_bar | å­£èŠ‚å¾½ç«  + å¤©æ°”å›¾æ ‡ + è¿æ¥ç¯ + tokenè¿›åº¦æ¡ | 3.1 |
| 3.5 | é‡å†™status_panel | ç‰©å“å›¾æ ‡ + last_action_result + è£…å¤‡æ˜¾ç¤º | 3.1 |
| 3.6 | é‡å†™npc_list_panel | ç²¾çµé¢„è§ˆ + æƒ…ç»ªå›¾æ ‡ + ç‚¹å‡»æ‰“å¼€è¯¦æƒ… | 3.1 |
| 3.7 | åˆ›å»ºè§’è‰²è¯¦æƒ…å¼¹çª— | `character_detail.gd`: ç«‹ç»˜+å¡”ç½—+å…³ç³»ç½‘+ä¸–ç•Œè§‚ | 3.6 |
| 3.8 | é‡å†™dialogue_panel | å±…ä¸­è¦†ç›– + NPCå¤´åƒ+é¢œè‰² + æ‰“å­—æœºæ•ˆæœ | 3.1 |
| 3.9 | é‡å†™market_panel | ä¸»é¢˜åŒ– + ç‰©å“å›¾æ ‡ | 3.1 |
| 3.10 | é‡å†™narrative_panel | å·¦ä¾§å¯æŠ˜å  + åˆ†ç±»ç€è‰² + æ—¶é—´æˆ³ | 3.1 |
| 3.11 | é‡å†™mini_map | æ–‡å­—â†’è§†è§‰æ–¹å— + NPCç‚¹ + è§†å£çŸ©å½¢ | 3.1 |
| 3.12 | é‡å†™action_bar | å›¾æ ‡æŒ‰é’® + ä¸Šä¸‹æ–‡æ•æ„Ÿ(äº¤æ˜“æ‰€æ—¶æ˜¾ç¤ºä¹°å–) | 3.1 |
| 3.13 | é‡å†™settings_panel | å®Œæ•´6èŠ‚è®¾ç½® | 3.1 |
| 3.14 | åˆ›å»ºè®¾ç½®ç®¡ç†å™¨ | `settings_manager.gd`: ConfigFileæŒä¹…åŒ– | 3.13 |
| 3.15 | é‡å†™god_panel | ç´«è‰²è¾¹æ¡†è¦†ç›– + æ·¡å…¥åŠ¨ç”» + å­£èŠ‚å›¾æ ‡ | 3.1 |
| 3.16 | éªŒè¯ | æ‰€æœ‰é¢æ¿åŠŸèƒ½æ­£å¸¸ + ä¸»é¢˜ä¸€è‡´ | 3.15 |

### é˜¶æ®µ 4: è§†è§‰æ•ˆæœ + æ•°æ®é›†æˆ

**äº¤ä»˜ç‰©**: å¤©æ°”ç²’å­ + æ˜¼å¤œå¾ªç¯ + èµ„æº/å®¶å…·å¯è§ + æ–°æ•°æ®å­—æ®µ

| åºå· | ä»»åŠ¡ | è¯¦æƒ… | ä¾èµ– |
|---|---|---|---|
| 4.1 | å¤©æ°”ç²’å­ç³»ç»Ÿ | `weather_fx.gd`: sunny=å…³ / rainy=200ç²’å­ / storm=å¯†é›†+é—ªç”µ | é˜¶æ®µ2 |
| 4.2 | æ˜¼å¤œå¾ªç¯ | `day_night.gd`: CanvasModulate æŒ‰phaseç€è‰² | é˜¶æ®µ2 |
| 4.3 | èµ„æºè¦†ç›–å±‚ | `resource_overlay.gd`: æœ‰èµ„æºçš„æ ¼å­æ˜¾ç¤ºè¦†ç›–ç²¾çµ | é˜¶æ®µ2 |
| 4.4 | å®¶å…·è¦†ç›–å±‚ | `furniture_overlay.gd`: æœ‰å®¶å…·çš„æ ¼å­æ˜¾ç¤ºå®¶å…·ç²¾çµ | é˜¶æ®µ2 |
| 4.5 | åç«¯åºåˆ—åŒ–å™¨æ‰©å±• | `ws/serializer.py`: æ·»åŠ  mood/last_action_result/season å­—æ®µ | æ—  |
| 4.6 | GameStateæ‰©å±• | `game_state.gd`: æ–°å¢ç¼“å­˜å­—æ®µ + season_changedä¿¡å· | 4.5 |
| 4.7 | UIæ•°æ®ç»‘å®š | å„é¢æ¿è¯»å–å¹¶æ˜¾ç¤ºæ–°å­—æ®µ | 4.6 |
| 4.8 | éªŒè¯ | å¤©æ°”æ•ˆæœ+æ˜¼å¤œ+èµ„æº/å®¶å…·æ˜¾ç¤º+mood/seasonæ•°æ® | 4.7 |

### é˜¶æ®µ 5: æ‰“ç£¨

**äº¤ä»˜ç‰©**: å®Œæ•´çš„äº§å“çº§æ¸¸æˆä½“éªŒ

| åºå· | ä»»åŠ¡ |
|---|---|
| 5.1 | åœºæ™¯åˆ‡æ¢æ·¡å…¥æ·¡å‡º |
| 5.2 | ä¸»èœå•è§†è§‰å‡çº§ï¼ˆHDèƒŒæ™¯å›¾ï¼‰ |
| 5.3 | å¯¹è¯æ‰“å­—æœºæ•ˆæœ |
| 5.4 | é¢æ¿æ»‘å…¥/æ»‘å‡ºTweenåŠ¨ç”» |
| 5.5 | è§’è‰²é€‰ä¸­/è¯¦æƒ…äº¤äº’å®Œå–„ |
| 5.6 | å°åœ°å›¾ç‚¹å‡»è·³è½¬ |
| 5.7 | Toasté€šçŸ¥ç³»ç»Ÿ |
| 5.8 | InputMapè‡ªå®šä¹‰æŒ‰é”® |
| 5.9 | è¿æ¥æ–­å¼€/é‡è¿è¦†ç›–å±‚ |
| 5.10 | è§’è‰²èŠ‚ç‚¹å¯¹è±¡æ±  |
| 5.11 | æ•´ä½“æ€§èƒ½ä¼˜åŒ– |

### éªŒè¯é‡Œç¨‹ç¢‘

| é˜¶æ®µ | éªŒè¯æ ‡å‡† |
|---|---|
| é˜¶æ®µ1å | å¯åŠ¨æ¸¸æˆ â†’ çœ‹åˆ°20Ã—20å½©è‰²TileMapåœ°å›¾ + åŸºæœ¬UIé¢æ¿æ¡†æ¶ |
| é˜¶æ®µ2å | 10ä¸ªè§’è‰²ç²¾çµåœ¨åœ°å›¾ä¸Šå¹³æ»‘ç§»åŠ¨ + æ‘„åƒæœºè·Ÿéš + æ»šè½®ç¼©æ”¾ |
| é˜¶æ®µ3å | æš—é»‘å¡”ç½—ä¸»é¢˜UI + æ‰€æœ‰é¢æ¿åŠŸèƒ½æ­£å¸¸ + è§’è‰²è¯¦æƒ…å¼¹çª—å«ç«‹ç»˜ |
| é˜¶æ®µ4å | é›¨å¤©æœ‰ç²’å­ + å¤œæ™šå˜æš— + èµ„æº/å®¶å…·å¯è§ + mood/seasonæ˜¾ç¤º |
| é˜¶æ®µ5å | å®Œæ•´æ¸¸æˆä½“éªŒï¼Œæ‰€æœ‰ç³»ç»Ÿåè°ƒï¼Œæ— æ˜æ˜¾Bug |

---

## 6. åç«¯æ•°æ®æ¥å£

### 6.1 WebSocketæ•°æ®æµ

```
Pythonåç«¯ (FastAPI)
  â†“ ws://localhost:8000/ws
  â†“ JSON world_state (æ¯ä¸ªworld tickå¹¿æ’­)
Godotå®¢æˆ·ç«¯
  â†“ WSClient._on_data(data)
  â†“ GameState.update_from_server(data)
  â†“ world_state_updatedä¿¡å·
  â†“ game_manager._on_world_updated()
  â†“ æ›´æ–°WorldLayer + UILayer
```

### 6.2 åºåˆ—åŒ–å™¨ä¿®æ”¹éœ€æ±‚ (`ws/serializer.py`)

```python
# _serialize_npc() æ–°å¢:
"mood": getattr(npc, "mood", ""),
"last_action_result": getattr(npc, "last_action_result", ""),

# _serialize_player() æ–°å¢:
"last_action_result": getattr(player, "last_action_result", ""),

# world_snapshot() timeå¯¹è±¡æ–°å¢:
"season": season_key,          # "spring"/"summer"/"autumn"/"winter"
"season_name": season_name,    # "æ˜¥Â·æ’­ç§"/"å¤Â·å¼‚å˜"/...

# world_snapshot() godå¯¹è±¡æ–°å¢:
"season": narrative_state.current_season,
"narrative_stage": narrative_state.secret_stage,
```

### 6.3 GameStateæ‰©å±•éœ€æ±‚ (`game_state.gd`)

```gdscript
# æ–°å¢å˜é‡:
var season: String = "spring"
var season_name: String = "æ˜¥Â·æ’­ç§"
var narrative_stage: int = 0

# æ–°å¢ä¿¡å·:
signal season_changed(new_season: String)
signal character_detail_requested(npc_id: String)

# update_from_server() æ–°å¢è§£æ:
var new_season = time_data.get("season", "spring")
if new_season != season:
    season = new_season
    season_name = time_data.get("season_name", "")
    season_changed.emit(season)
```

---

## 7. è§’è‰²ä¸å™äº‹ç³»ç»Ÿå‚è€ƒ

### 7.1 ä¹ä¸ªNPCå®Œæ•´è®¾å®š

| NPC ID | åå­— | å¡”ç½— | è§’è‰² | æ„ŸçŸ¥å±‚çº§ | ç‰¹æ®Š |
|---|---|---|---|---|---|
| `npc_he` | ç¦¾ | III çš‡å | æ¯äº²/æ‘å­æƒ…æ„Ÿä¸­å¿ƒ | blocked (å¼ºå±éšœ) | ä¸ˆå¤«æ­»äºç»“ç•Œ |
| `npc_sui` | ç©— | XIX å¤ªé˜³ | ç¦¾çš„å¥³å„¿/~8å² | strongest (ç›´è§‰ç©¿é€) | ç”»å‡ºå¼‚å¸¸æ™¯è±¡ |
| `npc_shan` | å±± | IX éšè€… | è€æ‘é•¿/å…¨çŸ¥è€… | omniscient (è½®å›è§è¯è€…) | æŒæœ‰å‘½è¿ä¹‹è½® |
| `npc_tang` | æ£  | XII å€’åŠäºº | ç©å®¶ç«¥å¹´ç©ä¼´ | medium_strong (äº¤æ˜“åå±éšœç¢) | ä¸æ¶é­”æœ‰äº¤æ˜“ |
| `npc_kuang` | æ—· | VIII åŠ›é‡ | å°ç”·å­©/~6å² | medium (å„¿ç«¥å¤©ç„¶æŠµæŠ—) | å¥½å¥‡å¿ƒæ—ºç›› |
| `npc_mu` | æœ¨ | V æ•™çš‡ | è€å·¥åŒ  | blocked (å¼ºå±éšœ) | ç»´æŠ¤æ³•é˜µéƒ¨ä»¶ |
| `npc_lan` | å²šå©† | II å¥³ç¥­å¸ | ç¥å©†/é€šçµè€… | strong (çœŸæ„ŸçŸ¥ä¼ªè£…éª—æœ¯) | çŸ³çš„æ¯äº² |
| `npc_shi` | çŸ³ | VI æ‹äºº | çŒäºº/å²šå©†ä¹‹å­ | weak (è‡ªä»¥ä¸ºæœ‰) | æš—æ‹ç¦¾ |
| `npc_shangren` | å•†äºº | XV æ¶é­” | æ¶é­”/äº¤æ˜“è€… | transcendent (ä¸å—çº¦æŸ) | çœŸå®èº«ä»½ä¸ºæ¶é­” |

### 7.2 æ€§æ ¼YAMLæ–‡ä»¶ä½ç½®

æ‰€æœ‰NPCæ€§æ ¼å®šä¹‰åœ¨ `agents/personalities/` ç›®å½•ï¼š
```
agents/personalities/
â”œâ”€â”€ god.yaml      â† God/çˆ·çˆ·
â”œâ”€â”€ he.yaml       â† ç¦¾
â”œâ”€â”€ sui.yaml      â† ç©—
â”œâ”€â”€ shan.yaml     â† å±±
â”œâ”€â”€ tang.yaml     â† æ£ 
â”œâ”€â”€ kuang.yaml    â† æ—·
â”œâ”€â”€ mu.yaml       â† æœ¨
â”œâ”€â”€ lan.yaml      â† å²šå©†
â”œâ”€â”€ shi.yaml      â† çŸ³
â””â”€â”€ shangren.yaml â† å•†äºº
```

æ¯ä¸ªYAMLåŒ…å«: `name, role, tarot, background, public_traits, hidden_desire, forbidden_topics, secret_connection, relationships, daily_routines, voice_samples, worldview, emotional_triggers, cognitive_barrier, perception_level`

### 7.3 å™äº‹å­£èŠ‚ç³»ç»Ÿ

| å­£èŠ‚ | å¤©æ•° | å™äº‹é˜¶æ®µ | æ°›å›´ | Godè¯­è°ƒ |
|---|---|---|---|---|
| æ˜¥Â·æ’­ç§ | Day 1-28 | Stage 0 | æ¸©é¦¨ã€å……æ»¡å¸Œæœ› | å¹³æ·¡è‡ªç„¶ï¼Œæ…ˆç¥¥æ—ç™½è€… |
| å¤Â·å¼‚å˜ | Day 29-56 | Stage 1 | å¾®å¦™ä¸å®‰ï¼Œé—·é›· | ç´§å¼ ä¿æŠ¤æ¬²ï¼Œå¶å°”å¤±è¨€ |
| ç§‹Â·ç¢è£‚ | Day 57-84 | Stage 2 | çœŸç›¸ç¢ç‰‡ï¼Œè½å¶ | çŸ›ç›¾æƒ…æ„Ÿï¼Œå®ˆæŠ¤è€…æŒ£æ‰ |
| å†¬Â·æŠ‰æ‹© | Day 85-112 | Stage 3 | å¯’å†·æ²‰é‡ï¼Œå¤©ç¾è¿«è¿‘ | å¦è¯šé¢å¯¹ï¼Œæ”¾ä¸‹ä¼ªè£… |

### 7.4 ç»“å±€ç³»ç»Ÿ

| ç»“å±€ | åç§° | å¡”ç½— | è§¦å‘æ¡ä»¶ |
|---|---|---|---|
| 1 | æ„šè€…å è½ (å¤±è´¥) | 0 é€†ä½ | Day 112æœªå‘ç°çœŸç›¸ |
| 2 | çš‡å¸çš„ç§©åº (å·©å›º) | IV | å¸®çˆ·çˆ·åŠ å›ºç»“ç•Œ |
| 3 | èµ°è¿‡çš‡å¸ (æ¨ç¿») | è¶…è¶ŠIV | æ‹’ç»ç»“ç•Œå¯»æ–°è·¯ |
| 4A | æ¶é­”çš„é”é“¾ (æ›¿ä»£) | XV | ä¸æ¶é­”ç­¾çº¦æˆæ–°God |
| 4B | æ¶é­”çš„å…¬å¹³ (æ‰­æ›²è‡ªç”±) | XV | å€Ÿæ¶é­”åŠ›è§£æ”¾æ‰€æœ‰äºº |
| 5 | å‘½è¿ä¹‹è½® (è§‰é†’) | X | å‘ç°è½®å›+å±±ä¿¡ä»»90 |
| çœŸ | ä¸–ç•Œ (æ‰“ç ´ä¸€åˆ‡å¢™) | XXI | å®Œæˆå…¨éƒ¨22å¼ ç‰Œ+æ‰€æœ‰ç»“å±€ |

### 7.5 çº¿ç´¢ç³»ç»Ÿ

**11æ¡çº¿ç´¢**:
- æ ¸å¿ƒ(6): ç»“ç•Œå­˜åœ¨, æ¶é­”å¥‘çº¦, æ‘å­æ¡æ¢, çˆ·çˆ·èº«ä»½, å®ˆæŠ¤ä»ªå¼, æ³•é˜µç»„ä»¶
- æ·±å±‚(3): å®ˆæŠ¤è€…å­˜åœ¨, çœŸå‡é€šçµ, æ¶é­”èº«ä»½
- è½®å›(2): è½®å›æš—ç¤º, å‘½è¿ä¹‹è½®

### 7.6 ä¸–ç•Œé…ç½®å¿«é€Ÿå‚è€ƒ

```
åœ°å›¾: 20Ã—20 ç½‘æ ¼
åœ°å½¢: è‰åœ°(g), æ£®æ—(f), å²©çŸ³(r), æ°´åŸŸ(w), åŸé•‡(o)
èµ„æº: æœ¨å¤´(wood), çŸ³å¤´(stone), çŸ¿çŸ³(ore), é£Ÿç‰©(food), è‰è¯(herb)
åˆæˆ: rope=woodÃ—2, potion=herbÃ—2, tool=stone+wood, bread=foodÃ—2
å®¶å…·: bed=woodÃ—4, table=woodÃ—3, chair=woodÃ—2
åŸé•‡ä¸­å¿ƒ: (9,9)~(10,10)
äº¤æ˜“æ‰€: (10,10)
ç©å®¶èµ·å§‹: (12,12)
å¤©æ°”: sunny/rainy/storm
æ—¶æ®µ: dawn/day/dusk/night
èƒŒåŒ…ä¸Šé™: 20æ ¼
```

---

## é™„å½•: Nano Banana Pro é›†æˆ

### APIè°ƒç”¨æ¨¡å¼

`tools/generate_hd_assets.py` éœ€è¦å®ç°:

1. **ç»Ÿä¸€é£æ ¼prompt**: æ‰€æœ‰HDèµ„äº§å…±äº«ä¸€ä¸ªé£æ ¼å‰ç¼€ï¼Œç¡®ä¿è§†è§‰ä¸€è‡´æ€§
2. **æ‰¹é‡ç”Ÿæˆ**: æŒ‰ç±»åˆ«æ‰¹é‡è°ƒç”¨APIï¼ˆè§’è‰²ç«‹ç»˜â†’å¤´åƒâ†’å¡”ç½—â†’CGï¼‰
3. **åå¤„ç†**: å¯¹ç”Ÿæˆå›¾åƒè¿›è¡Œè£å‰ªã€ç¼©æ”¾ã€é¢œè‰²æ ¡æ­£ä»¥åŒ¹é…é¡¹ç›®è‰²æ¿
4. **ç¼“å­˜**: å·²ç”Ÿæˆçš„èµ„äº§ä¸é‡å¤ç”Ÿæˆï¼ˆæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼‰
5. **é”™è¯¯é‡è¯•**: APIè°ƒç”¨å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•

### å»ºè®®çš„promptæ¨¡æ¿

**é£æ ¼å‰ç¼€** (æ‰€æœ‰èµ„äº§ç»Ÿä¸€ä½¿ç”¨):
```
HD-2D style illustration inspired by Octopath Traveler aesthetics combined with Don't Starve's
dark whimsy. Rich hand-painted textures on semi-realistic characters. Muted earthy color palette
with warm undertones. Vignette lighting creating intimate atmosphere. Slightly unsettling fairy
tale quality â€” beautiful but something feels off. Dark tarot card inspired composition.
```

**è§’è‰²ç«‹ç»˜**:
```
{é£æ ¼å‰ç¼€}
Portrait of [è§’è‰²æè¿°], [ç‰¹å¾], [è¡¨æƒ…], [æœè£…].
Background: soft warm light with dark edges.
Style: upper body portrait, facing slightly to the side.
```

**å¡”ç½—ç‰Œé¢**:
```
{é£æ ¼å‰ç¼€}
Tarot card illustration: [ç‰Œå]. [è±¡å¾æè¿°].
Ornate golden border with mystical symbols.
Dark background with subtle magical glow.
```

**CGåœºæ™¯**:
```
{é£æ ¼å‰ç¼€}
Wide landscape scene: [åœºæ™¯æè¿°].
Atmospheric perspective, layered depth.
[å­£èŠ‚/å¤©æ°”ç‰¹æ•ˆæè¿°].
```

---

*æ–‡æ¡£ç»“æŸã€‚æœ€åæ›´æ–°: 2026-02-27*
